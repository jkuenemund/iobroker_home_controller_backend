{
  "version": 3,
  "sources": ["../../../src/lib/websocket/types.ts"],
  "sourcesContent": ["// WebSocket Message Types for Home Controller Adapter\n\n// =============================================================================\n// Base Message Types\n// =============================================================================\n\n/**\n * Base interface for all WebSocket messages\n */\nexport interface BaseMessage {\n    /** Message type identifier */\n    type: string;\n    /** Optional request ID for request/response matching */\n    id?: string;\n    /** Sequence number (server-assigned on outbound messages) */\n    seq?: number;\n    /** Timestamp ISO-String (server-assigned on outbound messages) */\n    ts?: string;\n    /** Schema/Envelope version */\n    version?: string;\n}\n\n/**\n * Error information included in error responses\n */\nexport interface ErrorInfo {\n    code: string;\n    message: string;\n    details?: Record<string, unknown>;\n}\n\n/**\n * Base interface for error responses\n */\nexport interface ErrorMessage extends BaseMessage {\n    type: \"error\";\n    error: ErrorInfo;\n}\n\n// =============================================================================\n// Client \u2192 Server Messages\n// =============================================================================\n\n/**\n * Client registration request\n */\nexport interface RegisterRequest extends BaseMessage {\n    type: \"register\";\n    payload: {\n        clientName: string;\n        clientVersion: string;\n        clientType: \"mobile\" | \"web\" | \"desktop\" | \"other\";\n        lastSeqSeen?: number;\n        acceptCompression?: boolean;\n    };\n}\n\n/**\n * Request to get all devices\n */\nexport interface GetDevicesRequest extends BaseMessage {\n    type: \"getDevices\";\n}\n\n/**\n * Request to get all rooms\n */\nexport interface GetRoomsRequest extends BaseMessage {\n    type: \"getRooms\";\n}\n\n/**\n * Request available commands\n */\nexport interface HelpRequest extends BaseMessage {\n    type: \"help\";\n}\n\n/**\n * Request full snapshot (devices + rooms)\n */\nexport interface GetSnapshotRequest extends BaseMessage {\n    type: \"getSnapshot\";\n}\n\n// =============================================================================\n// Server \u2192 Client Messages\n// =============================================================================\n\n/**\n * Server response to successful registration\n */\nexport interface RegisteredResponse extends BaseMessage {\n    type: \"registered\";\n    payload: {\n        clientId: string;\n        serverVersion: string;\n        protocolVersion: string;\n        schemaVersion: string;\n        capabilities: string[];\n        limits: {\n            maxMsgBytes: number;\n            maxEventsPerSecond: number;\n            supportsBatch: boolean;\n            supportsCompression: boolean;\n            defaultSubscription: \"all\" | \"none\";\n        };\n    };\n}\n\n/**\n * Device configuration (matches the JSON stored in ioBroker states)\n */\nexport interface DeviceConfig {\n    name: string;\n    type: string;\n    room: string;\n    icon: string;\n    capabilities: DeviceCapability[];\n    manufacturer?: string;\n    model?: string;\n    description?: string;\n}\n\n/**\n * Device capability definition\n */\nexport interface DeviceCapability {\n    type: string;\n    state: string;\n    description?: string;\n    min?: number;\n    max?: number;\n    unit?: string;\n    inverted?: boolean;\n    stop?: string;\n    /** Current value of the state (if available) */\n    value?: unknown;\n}\n\n/**\n * Response containing all devices\n */\nexport interface DevicesResponse extends BaseMessage {\n    type: \"devices\";\n    payload: {\n        devices: Record<string, DeviceConfig>;\n    };\n}\n\n/**\n * Room configuration (matches the JSON stored in ioBroker states)\n */\nexport interface RoomConfig {\n    name: string;\n    icon: string;\n    metrics?: RoomMetric[];\n}\n\n/**\n * Room metric definition\n */\nexport interface RoomMetric {\n    type: string;\n    state: string;\n    label?: string;\n    unit?: string;\n    value?: unknown;\n    ts?: string;\n}\n\n/**\n * Response containing all rooms\n */\nexport interface RoomsResponse extends BaseMessage {\n    type: \"rooms\";\n    payload: {\n        rooms: Record<string, RoomConfig>;\n    };\n}\n\nexport interface SnapshotPayload {\n    devices: Record<string, DeviceConfig>;\n    rooms: Record<string, RoomConfig>;\n    seq: number;\n}\n\nexport interface SnapshotResponse extends BaseMessage {\n    type: \"snapshot\";\n    payload: SnapshotPayload;\n}\n\nexport interface InitialSnapshotResponse extends BaseMessage {\n    type: \"initialSnapshot\";\n    payload: SnapshotPayload;\n}\n\n/**\n * Command definition for help response\n */\nexport interface CommandDefinition {\n    command: string;\n    description: string;\n    example: object;\n}\n\n/**\n * Response containing available commands\n */\nexport interface HelpResponse extends BaseMessage {\n    type: \"help\";\n    payload: {\n        commands: CommandDefinition[];\n    };\n}\n\n/**\n * State change notification\n */\nexport interface StateChangeMessage extends BaseMessage {\n    type: \"stateChange\";\n    payload: {\n        deviceId: string;\n        capability: string;\n        state: string;\n        value: unknown;\n        timestamp: string;\n        quality?: string;\n    };\n}\n\n// =============================================================================\n// Client State Management\n// =============================================================================\n\n/**\n * Request log entry for debugging\n */\nexport interface RequestLogEntry {\n    /** Timestamp of the request */\n    timestamp: Date;\n    /** Message type */\n    type: string;\n    /** Request ID */\n    id?: string;\n}\n\n/**\n * Connected client information\n */\nexport interface ConnectedClient {\n    /** Unique client ID assigned by server */\n    id: string;\n    /** Client-provided name */\n    name: string;\n    /** Client version */\n    version: string;\n    /** Client type */\n    clientType: string;\n    /** Connection timestamp */\n    connectedAt: Date;\n    /** Whether client has completed registration */\n    isRegistered: boolean;\n    /** Recent requests for debugging (last 10) */\n    recentRequests: RequestLogEntry[];\n}\n\n// =============================================================================\n// Union Types for Message Routing\n// =============================================================================\n\n/**\n * All possible client \u2192 server message types\n */\nexport type ClientMessage = RegisterRequest | GetDevicesRequest | GetRoomsRequest | GetSnapshotRequest | HelpRequest;\n\n/**\n * All possible server \u2192 client message types\n */\nexport type ServerMessage =\n    | RegisteredResponse\n    | DevicesResponse\n    | RoomsResponse\n    | SnapshotResponse\n    | InitialSnapshotResponse\n    | HelpResponse\n    | StateChangeMessage\n    | ErrorMessage;\n\n// =============================================================================\n// Error Codes\n// =============================================================================\n\nexport const ErrorCodes = {\n    NOT_REGISTERED: \"NOT_REGISTERED\",\n    INVALID_MESSAGE: \"INVALID_MESSAGE\",\n    UNKNOWN_TYPE: \"UNKNOWN_TYPE\",\n    INTERNAL_ERROR: \"INTERNAL_ERROR\",\n    AUTH_FAILED: \"AUTH_FAILED\",\n    TOKEN_EXPIRED: \"TOKEN_EXPIRED\",\n    PERMISSION_DENIED: \"PERMISSION_DENIED\",\n    UNSUPPORTED_VERSION: \"UNSUPPORTED_VERSION\",\n    INVALID_PAYLOAD: \"INVALID_PAYLOAD\",\n    RATE_LIMIT: \"RATE_LIMIT\",\n    CERT_ERROR: \"CERT_ERROR\",\n    RESYNC_REQUIRED: \"RESYNC_REQUIRED\",\n} as const;\n\nexport type ErrorCode = (typeof ErrorCodes)[keyof typeof ErrorCodes];\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAqSO,MAAM,aAAa;AAAA,EACtB,gBAAgB;AAAA,EAChB,iBAAiB;AAAA,EACjB,cAAc;AAAA,EACd,gBAAgB;AAAA,EAChB,aAAa;AAAA,EACb,eAAe;AAAA,EACf,mBAAmB;AAAA,EACnB,qBAAqB;AAAA,EACrB,iBAAiB;AAAA,EACjB,YAAY;AAAA,EACZ,YAAY;AAAA,EACZ,iBAAiB;AACrB;",
  "names": []
}
