{
  "version": 3,
  "sources": ["../../../src/lib/websocket/types.ts"],
  "sourcesContent": ["/* eslint-disable jsdoc/require-jsdoc */\n\n// WebSocket Message Types for Home Controller Adapter\n\n// =============================================================================\n// Base Message Types\n// =============================================================================\n\n/**\n * Base interface for all WebSocket messages\n */\nexport interface BaseMessage {\n\t/** Message type identifier */\n\ttype: string;\n\t/** Optional request ID for request/response matching */\n\tid?: string;\n\t/** Sequence number (server-assigned on outbound messages) */\n\tseq?: number;\n\t/** Timestamp ISO-String (server-assigned on outbound messages) */\n\tts?: string;\n\t/** Schema/Envelope version */\n\tversion?: string;\n}\n\n/**\n * Error information included in error responses\n */\nexport interface ErrorInfo {\n\tcode: string;\n\tmessage: string;\n\tdetails?: Record<string, unknown>;\n}\n\n/**\n * Base interface for error responses\n */\nexport interface ErrorMessage extends BaseMessage {\n\ttype: \"error\";\n\terror: ErrorInfo;\n}\n\n// =============================================================================\n// Client \u2192 Server Messages\n// =============================================================================\n\n/**\n * Client registration request\n */\nexport interface RegisterRequest extends BaseMessage {\n\ttype: \"register\";\n\tpayload: {\n\t\tclientName: string;\n\t\tclientVersion: string;\n\t\tclientType: \"mobile\" | \"web\" | \"desktop\" | \"other\";\n\t\tlastSeqSeen?: number;\n\t\tacceptCompression?: boolean;\n\t};\n}\n\n/**\n * Request to get all devices\n */\nexport interface GetDevicesRequest extends BaseMessage {\n\ttype: \"getDevices\";\n}\n\n/**\n * Request to get all rooms\n */\nexport interface GetRoomsRequest extends BaseMessage {\n\ttype: \"getRooms\";\n}\n\n/**\n * Request available commands\n */\nexport interface HelpRequest extends BaseMessage {\n\ttype: \"help\";\n}\n\n/**\n * Request full snapshot (devices + rooms)\n */\nexport interface GetSnapshotRequest extends BaseMessage {\n\ttype: \"getSnapshot\";\n}\n\nexport interface SubscribeRequest extends BaseMessage {\n\ttype: \"subscribe\";\n\tpayload?: {\n\t\tdeviceIds?: string[];\n\t\trooms?: string[];\n\t\tcapabilityTypes?: string[];\n\t};\n}\n\nexport interface UnsubscribeRequest extends BaseMessage {\n\ttype: \"unsubscribe\";\n\tpayload?: {\n\t\tdeviceIds?: string[];\n\t\trooms?: string[];\n\t\tcapabilityTypes?: string[];\n\t};\n}\n\nexport interface SetStateRequest extends BaseMessage {\n\ttype: \"setState\";\n\tpayload: {\n\t\tdeviceId: string;\n\t\tcapability: string;\n\t\tstate: string;\n\t\tvalue: unknown;\n\t\tack?: boolean;\n\t};\n}\n\n// =============================================================================\n// Server \u2192 Client Messages\n// =============================================================================\n\n/**\n * Server response to successful registration\n */\nexport interface RegisteredResponse extends BaseMessage {\n\ttype: \"registered\";\n\tpayload: {\n\t\tclientId: string;\n\t\tserverVersion: string;\n\t\tprotocolVersion: string;\n\t\tschemaVersion: string;\n\t\tcapabilities: string[];\n\t\tlimits: {\n\t\t\tmaxMsgBytes: number;\n\t\t\tmaxEventsPerSecond: number;\n\t\t\tsupportsBatch: boolean;\n\t\t\tsupportsCompression: boolean;\n\t\t\tdefaultSubscription: \"all\" | \"none\";\n\t\t};\n\t};\n}\n\n/**\n * Device configuration (matches the JSON stored in ioBroker states)\n */\nexport interface DeviceConfig {\n\tname: string;\n\ttype: string;\n\troom: string;\n\ticon: string;\n\tcapabilities: DeviceCapability[];\n\tmanufacturer?: string;\n\tmodel?: string;\n\tdescription?: string;\n}\n\n/**\n * Device capability definition\n */\nexport interface DeviceCapability {\n\ttype: string;\n\tstate: string;\n\tdescription?: string;\n\tmin?: number;\n\tmax?: number;\n\tunit?: string;\n\tinverted?: boolean;\n\tstop?: string;\n\t/** Current value of the state (if available) */\n\tvalue?: unknown;\n}\n\n/**\n * Response containing all devices\n */\nexport interface DevicesResponse extends BaseMessage {\n\ttype: \"devices\";\n\tpayload: {\n\t\tdevices: Record<string, DeviceConfig>;\n\t};\n}\n\n/**\n * Room configuration (matches the JSON stored in ioBroker states)\n */\nexport interface RoomConfig {\n\tname: string;\n\ticon: string;\n\tmetrics?: RoomMetric[];\n}\n\n/**\n * Room metric definition\n */\nexport interface RoomMetric {\n\ttype: string;\n\tstate: string;\n\tlabel?: string;\n\tunit?: string;\n\tvalue?: unknown;\n\tts?: string;\n}\n\n/**\n * Response containing all rooms\n */\nexport interface RoomsResponse extends BaseMessage {\n\ttype: \"rooms\";\n\tpayload: {\n\t\trooms: Record<string, RoomConfig>;\n\t};\n}\n\nexport interface SnapshotPayload {\n\tdevices: Record<string, DeviceConfig>;\n\trooms: Record<string, RoomConfig>;\n\tseq: number;\n}\n\nexport interface SnapshotResponse extends BaseMessage {\n\ttype: \"snapshot\";\n\tpayload: SnapshotPayload;\n}\n\nexport interface InitialSnapshotResponse extends BaseMessage {\n\ttype: \"initialSnapshot\";\n\tpayload: SnapshotPayload;\n}\n\n/**\n * Command definition for help response\n */\nexport interface CommandDefinition {\n\tcommand: string;\n\tdescription: string;\n\texample: object;\n}\n\n/**\n * Response containing available commands\n */\nexport interface HelpResponse extends BaseMessage {\n\ttype: \"help\";\n\tpayload: {\n\t\tcommands: CommandDefinition[];\n\t};\n}\n\n/**\n * State change notification\n */\nexport interface StateChangeMessage extends BaseMessage {\n\ttype: \"stateChange\";\n\tpayload: {\n\t\tdeviceId: string;\n\t\tcapability: string;\n\t\tstate: string;\n\t\tvalue: unknown;\n\t\ttimestamp: string;\n\t\tquality?: string;\n\t};\n}\n\n// =============================================================================\n// Client State Management\n// =============================================================================\n\n/**\n * Request log entry for debugging\n */\nexport interface RequestLogEntry {\n\t/** Timestamp of the request */\n\ttimestamp: Date;\n\t/** Message type */\n\ttype: string;\n\t/** Request ID */\n\tid?: string;\n}\n\n/**\n * Connected client information\n */\nexport interface ConnectedClient {\n\t/** Unique client ID assigned by server */\n\tid: string;\n\t/** Client-provided name */\n\tname: string;\n\t/** Client version */\n\tversion: string;\n\t/** Client type */\n\tclientType: string;\n\t/** Connection timestamp */\n\tconnectedAt: Date;\n\t/** Whether client has completed registration */\n\tisRegistered: boolean;\n\t/** Recent requests for debugging (last 10) */\n\trecentRequests: RequestLogEntry[];\n}\n\n// =============================================================================\n// Union Types for Message Routing\n// =============================================================================\n\n/**\n * All possible client \u2192 server message types\n */\nexport type ClientMessage =\n\t| RegisterRequest\n\t| GetDevicesRequest\n\t| GetRoomsRequest\n\t| GetSnapshotRequest\n\t| HelpRequest\n\t| SubscribeRequest\n\t| UnsubscribeRequest\n\t| SetStateRequest;\n\n/**\n * All possible server \u2192 client message types\n */\nexport type ServerMessage =\n\t| RegisteredResponse\n\t| DevicesResponse\n\t| RoomsResponse\n\t| SnapshotResponse\n\t| InitialSnapshotResponse\n\t| HelpResponse\n\t| StateChangeMessage\n\t| ErrorMessage;\n\n// =============================================================================\n// Error Codes\n// =============================================================================\n\nexport const ErrorCodes = {\n\tNOT_REGISTERED: \"NOT_REGISTERED\",\n\tINVALID_MESSAGE: \"INVALID_MESSAGE\",\n\tUNKNOWN_TYPE: \"UNKNOWN_TYPE\",\n\tINTERNAL_ERROR: \"INTERNAL_ERROR\",\n\tAUTH_FAILED: \"AUTH_FAILED\",\n\tTOKEN_EXPIRED: \"TOKEN_EXPIRED\",\n\tPERMISSION_DENIED: \"PERMISSION_DENIED\",\n\tUNSUPPORTED_VERSION: \"UNSUPPORTED_VERSION\",\n\tINVALID_PAYLOAD: \"INVALID_PAYLOAD\",\n\tRATE_LIMIT: \"RATE_LIMIT\",\n\tCERT_ERROR: \"CERT_ERROR\",\n\tRESYNC_REQUIRED: \"RESYNC_REQUIRED\",\n} as const;\n\nexport type ErrorCode = (typeof ErrorCodes)[keyof typeof ErrorCodes];\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AA4UO,MAAM,aAAa;AAAA,EACzB,gBAAgB;AAAA,EAChB,iBAAiB;AAAA,EACjB,cAAc;AAAA,EACd,gBAAgB;AAAA,EAChB,aAAa;AAAA,EACb,eAAe;AAAA,EACf,mBAAmB;AAAA,EACnB,qBAAqB;AAAA,EACrB,iBAAiB;AAAA,EACjB,YAAY;AAAA,EACZ,YAAY;AAAA,EACZ,iBAAiB;AAClB;",
  "names": []
}
